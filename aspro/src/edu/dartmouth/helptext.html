<html>
<title>JSkyCalc Manual</title>
<BODY bgcolor="#d0e0f0">
<p>
<p>
<center><font size="+1">Using JSkyCalc</font></center>
<center><font size="+0">John Thorstensen, Dartmouth College; 2007 January</font></center>
<p>
<font size="+1">What is this for?</font>
<p>
JSkyCalc is a tool designed to help you plan and execute astronomical 
observations.  It shares some features with "desktop planetarium" programs
such as XEphem and its many commercial alternatives, but rather than
elegant visual presentation, the program emphasizes convenient controls 
and calculation of the quantities of greatest interest to professional 
astronomers.
<p>
<font size="+1">Getting Started</font>
<p>
<ul>
<li> The <b>main JSkyCalc window</b> controls most of the operation and 
reports the instantaneous circumstances.
<li> Fields with <b>white backgrounds</b> will <b>accept input</b>, such
as RA, dec, date and time.  (You don't need to supply the day of week, it's
computed on output.)  
<li> To <b> make computations happen </b> you can hit the <i>Enter</i>
key in an input field, or use the buttons at the bottom of the panel, 
like <b>Refresh output</b>.  
<li> On refresh, all the input is read, and both the input
and output are all overwritten with their values in the 
default formats.
<li> When you select a different site from the menu, the output
is computed for that site, for the same UT.
<li> If your site isn't listed on the menu, first
select <b>Enable user input</b> on the site menu.  The site fields 
in the main window 
turn white, indicating that they can accept your input.  Note the syntax
used for the <i>units</i> and <i>positive direction</i> of longitude --
for example,
" D E" (separated by spaces) would mean degrees east,  
while " H W" would mean hours west.  (If the program is installed
locally, you can change the site menu permanently by
altering a configuration file, as explained later.)
<li> Pressing <i>Enter</i> in the <b>timestep</b> field advances the
program time by the amount you set.  Units can be <b>d, h, m, s</b> for
days, hours, minutes, or seconds, <b>t</b> for sidereal days 
(successive transits), or <b>l</b> (letter L) for lunar months.
<li> One wrinkle: entering a Julian date in the <b>JD</b> field 
and pressing <i>Enter</i> sets the program time to the JD you entered.
<li> Another: Entering a negative year for equinox causes the
equinox of date to be computed and used instead.
</ul>
<p>
The <b>control buttons at the bottom of the frame</b> do the 
following; more detailed descriptions of some of the windows
they pop can be found a little further down:
<li> <b>Refresh Output</b> reads all the input values, computes
everything, and refreshes all the output.  The input values are
overwritten with the values that the program used, and the the 
day of week is appended to the date.
<li> <b>Set to now</b> sets the program time using your
computer's clock, and refreshes the output. 
<b>Step Forward</b> and <b>Step Back</b> step the 
time forward or back using the value of the <b>timestep</b>  
(explained above).
<li><b>Auto Update</b> keeps the program close to real time --
it sets everything using Java's clock time (which is UT), sleeps for 
the number of seconds indicated in the <i>sleep for (s)</i> field,
and then wakes up and updates again.  <b>Auto Step</b> steps
forward by the <i>timestep</i>, sleeps for the desired number
of seconds, and then repeats.  The <i>sleep for</i> field accepts only
integers.
<li>The <b>Site Menu</b> (which is displayed on startup) allows
you to select among many of the world's major observatories.  
Changing sites causes the computations to be refreshed; the
<i>Universal</i> time is kept the same, so the local
time will jump if the offset from UT is different.
If the desired site is not on the list you must enter its 
parameters in the fields in the main window, but you must
first click the button on the site menu to
<b><font color="#ff0000">Enable User Input</font></b>.
The <b>DST code</b> parameter is used to select the 
convention used for Daylight Savings time (if any).  The
US convention is 1 (but Arizona and Hawaii do not observe
DST); negative numbers are used for southern hemisphere sites.
[If you're using the program with WebStart, you're stuck with 
either using the pre-programmed menu choices or entering your
own site's parameters every time; if you install the program
locally, just find the file "skycalcsites.dat" and install
your own site following the format explained there.  
The file "skycalcsites.orig" should be left untouched
for use in case you inadvertently corrup "skycalcsites.dat".
The skycalcsites.dat file must be kept in the same 
directory as the class files.]
<li>The <b>Planet Table</b> gives low-precision positions
of the planets (to about 1 arcmin for the inner planets, and 
several arcmin for the outer ones), in the epoch of date.
The last column in the table, <i>Proximity</i>, gives the 
angular distance between the planet and the coordinates 
that are used in the main program.
<li><b>Hourly Circumstances</b> summarizes the observability of 
your object through the night.  If the time is before local noon,
the previous night is tabulated.  <b>This is among the most
heavily used features.</b>.  
<li><b>The Nightly Almanac</b> lists the times of sunset and
sunrise, twilight, and moonset and moonrise, corrected for the
<i>Terrain elevation</i> (of the observatory above its surroundings).
The terrain elevation must be a positive number (this is checked on
input and reset to zero if negative).  
<li><b>Seasonal Observability</b> presents a table summarizing the
observability of the object at each new moon and each full moon
over a span of about 6 months centered on the program date.
<li><b>Object lists ... </b> lets you read in a list of your
own objects, which you can then select from a menu or call by
name from the <i>Object</i> field in the main window.  They also
appear on the Sky display, and you can select them there with a
left mouse click.  <b>The Object List feature is extremely 
useful, but security features of WebStart prevent loading 
of object lists,</b> so you need to install the 
program locally to make it work; fortunately, this
is very straightforward.
<li>The <b>Sky Display</b> gives a schematic view of the sky, with
stars to V = 4.5 , the planets, the sun, the moon, and 
any objects loaded in the list indicated.  You can control some
things from the display window with <b>mouse and keyboard commands</b> --
holding down the <b>right mouse button</b> in the sky display 
gives a brief menu.
<li>The <b> Alt. Coordinates</b> window gives the input coordinates
precessed to the present equinox, the Galactic coordinates, and
the ecliptic coordinates.  If you type <i>Enter</i> in the 
Galactic coordinate field, the position in the main program is
set to the galactic coordinates you give, that is, the program 
converts from galactic back to equatorial.
<li>The <b>Airmass Graphs</b> window creates a display of 
airmass vs. time through the night.  Local time is plotted
at the bottom of the frame, and UT at the top.  Airmass is 
plotted vertically, with low airmass (small zenith distance)
at the top.  The altitude of the moon above the horizon, is 
plotted in yellow, with little symbols indicating the phase.
This is keyed to the yellow scale at the right-hand
side of the plot (<i>not</i> the same vertical
used for the airmass).  A few non-obvious features of this
tool:
<ul>
<li>Displaying the airmass graph causes
a little grey object-selector menu to appear, which 
shows the the object list if you've loaded one.  Use this
to select which objects to plot on the airmass graph.
To select more than one object at a time,
use <b>ctrl-click</b>, that is, hold down
the <i>Ctrl</i> key and click on the name with the left
mouse button.  Then click on the <i>Plot Airmasses</i>
button to see nice color-coded curves for the different
objects.
<li>
Within the airmass graph window itself, a <b>mouse click</b> 
sets the program time to the time you clicked, and updates
everything (it's pretty dramatic).
This lets you quickly see the circumstances
at any point during the night.
</ul>
<p>
<p>
<center><font size="+1">More detail on the Output Parameters</font></center>
<p>
<p>
The output parameters on the right-hand side of the 
window are:
<ul>
<li><i>sidereal</i> -- the local mean sidereal time, in H M S.
<li><i>HA</i> -- the hour angle, in H M S.  Negative values are east.
The field turns orange when the HA is more than 6 hours.
<li><i>Airmass</i> -- the true airmass, which is slightly different from the secant of z.  Yellow, orange, and red 
<b><font color="#ff8800">warning colors</font></b> are used at 
large airmass; yellow starts at airmass 2, orange at 3, and red 
at 4 (which is a huge airmass).
<li><i>parallactic</i> -- the position angle of "straight up", and its 180-degree
opposite.
<li><i>SunRAdec</i> -- the topocentric (corrected for observer's horizontal parallax) position
of the sun, in the equinox of date.  Accuracy should be better than 1 arcsec.
<li><i>SunAltAz</i> -- the altitude and azimuth of the sun, uncorrected for refraction.
<li><i>ZTwilight</i> -- An estimate of how many magnitudes of twilight there is in blue light at the zenith.  Yellow, orange, and red draw attention to this field when twilight might be an issue.  Light blue indicates daytime sky.
<li><i>MoonPhase</i> -- A verbal description of the moon phase.
<li><i>moonRAdec</i> -- The topocentric position of the moon in the equinox of date. 
The moon's horizontal parallax can be very large (up to 1 degree), so the correction is important here.
The lunar ephemeris used is good to about 10 arcseconds.
<li><i>moonAltAz</i> -- Altitude and azimuth of the moon, uncorrected for refraction.<li><i>illumFrac</i> -- Fraction of the moon's face that is illuminated.
<li><i>LunSkyBright</i> -- an estimate of the brightness of scattered moonlight,
in V magnitudes per square arcsecond, at the coordinates you're looking at.  This
is based on K. Krisciunas and B. Schaefer's analytical fit to their empirical 
measurements (1991, PASP, 103, 1033).
An elaborate warning color scheme is used, starting with light
blue when the background is roughly doubled from its dark value, and 
turning a light purple to indicate "normal" bright-run conditions.  When 
you're close to the moon a yellow-orange-red scheme comes into play.
<li><i>Moon-Obj ang.</i> -- Angle between the moon and the object.  Warning
colors are used to indicate problematic conditions.
<li><i>Bary. JD</i> -- The time corrected to the solar system center-of-mass
(nearly the same as the heliocentric correction, but more correct), and the size of 
the correction, which is accurate to a couple of hundredths of a second.
<li><i>Bary. Vcorrn</i> -- Add this to an observed radial velocity to get
the value observed from the solar system barycenter.  Accuracy is much
better than 10 m/s.
<li><i>Constellation</i> -- The constellation that the current coordinates
lie in.  This is computed using the algorithm given by N. G. Roman (1987, PASP,
99, 695).  Francois Ochsenbein's (CDS Strasbourg) implementation of this
algorithm in C is ported here to Java.  
<li><i>Planet Warning?</i> -- This field lights up when your coordinates
are near to a planet.  Being close to a bright planet (e.g. 1 degree from
Jupiter) gets a red warning.
</ul>
<p>
<center><font size="+1">More Detail on the Other Windows</font></center>
<p>
Except for the Site Menu and Sky Display window, these other windows
are all hidden on startup.  You can get the windows to show using the 
buttons at the bottom of the main panel -- the buttons toggle the 
corresponding window on and off.
Most of the windows also have their own
"hide" buttons.  Don't use your windowing system's buttons to close
windows, as this can kill processes.
<p>
The <b>Hourly Circumstances</b> window is a popular favorite.  It gives the
circumstances for the object coordinates (from the main window),
computed for each hour through the night.
Time is given in Local, UT, and sidereal (LST), followed by the hour
angle and airmass, followed by the altitude of the moon and the
sun.  Warning colors (red, orange, yellow, light purple, and blue) 
are used in the HA, airmass, moonalt, and sunalt columns.
If the time in the main window is before noon, the previous
night is shown; if the time is after noon, the coming night is shown.
This is so that if you run a calculation with the time set to 2 AM,
it computes the table for the most appropriate night.
<p>
The refresh time for this window can be noticeable; if you're not using
the output, you can hide it using the button provided, which turns off 
the refresh and can speed things up a bit.  You can put the window
back up using the button in the main window.
<p>
A button is provided to dump the contents of this window to a file
in your local directory.  The output is appended to the file, so you
can run a number of objects and then print the file.
<p>
The <b>Nightly Almanac</b> window gives times of sunset, sunrise,
twilight (when the sun is 18 degrees below the horizon), moonrise,
and moonset, defined as when the upper limb is on the visible
horizon.  When the terrain elevation is zero (this 
quantity is defined here as the 
elevation of the observatory above the terrain that forms its horizon),
the rise and set times are computed for when 
the center of the sun or moon is 90 degrees, 50 minutes from the zenith,
which accounts roughly for atmospheric refraction and the 
angular size.  If the terrain elevation is greater than zero,
the rise and set times are adjusted accordingly.   The sidereal
times at evening and morning 18-degree twilight are also listed.
<p>
If the time in the main program is before local noon, the 
previous night is computed.  If it's after local noon, the next
night is computed.  This is just like the Hourly Circumstances
window.  The window is invisible on startup, but can be revealed
or hidden using the buttons provided.
<p> 
The <b>Planet Table</b> gives low-precision coordinates of the planets,
derived from algorithms given by Jean Meeus in <i> Astronomical
Formulae for Calculators</i> (Willman-Bell).   The inner planets are good to
about a minute of arc, but the outer planets are somewhat worse,
and Pluto (I know, it's not a planet any more officially) is
pretty bad.  Coordinates are in the epoch of date.  
(These planetary positions are also used internally to find the offset between the
heliocenter and the barycenter for the barycentric corrections.)
The last column in the table, <i>Proximity</i>, gives the 
angular distance between the planet and the coordinates 
that are used in the main window.
The planet table can be printed using the built-in print
method provided by Java for this class.  
<p> 
The <b> Object List </b> window lets you read in a  
list of astronomical objects.  <b>Reading in a list of objects read in greatly
enhances the usability and power of the program</b> -- you don't have to 
type in coordinates, and the objects are graphed on the Sky 
Display.  The list must be in this format:
<pre>
     name_no_blanks   hh mm ss   dd mm ss   equinox
</pre>
for example, 
<pre>
     4U1234+56   12 34 35.3  56 01 02   1950
</pre>
The format is dictated by the telescope pointing list format expected 
at MDM Observatory, where
I do most of my observing.  Colons are acceptable as delimiters for the
RA and dec fields (but be advised that they don't work with the MDM telescope
software).  The <b>Load Object List</b> button pops a file-selecting
dialog box.  Once you've loaded up a list, you can click on the object 
you want, and it will be loaded into the program.   If you prefer,
you can also select an object by typing its exact name into the 
<i>Object:</i> field in the main window and 
pressing the <i>Enter</i> key.  You can present the
list in either RA or alphabetical order using the buttons 
provided, and the <b>Clear List</b> button deletes all the objects
(but for technical reasons, a single object called 
<i>null</i> at zero hours and zero degrees will remain).  A hide
button is provided also.
<p>
The <b>Alternate Coordinates</b> window gives the coordinates
precessed to the equinox of date, the galactic coordinates,
(which are rigorously accurate), and ecliptic coordinates.
There's no hide button --
use the button on the main window to toggle the window on and off.
<p>
The white background behind the galactic coordinates signifies
that they can be used for input.  Entering a value
in the galactic latitude or longitude fields and pressing <i>Enter</i>
sets the coordinates in the main window to the location specified
by the longitude and latitude you entered.  Thus the program can 
serve as a galactic-to-equatorial converter.  I have not implemented
an analagous function for ecliptic coordinates.
<p>
The <b>Seasonal Observability</b> window is useful for planning
when to observe an object (for example, in filling out a time
request form).  It takes the date from the main window, figures
out when new and full moons will occur for about three months on 
either side, and generates a table, each line of which gives a brief 
summary of the object's observability at each of these dates.
The hour angle and airmass are given at the start of the night,
the natural center of the night, and the end of the night.  The 
last three columns give the number of hours that the object is
accessible without twilight and at airmasses of less than 3,
less than 2, and less than 1.5.  A button is provided to print the
output.
<p> 
<center><font size="+1">The Sky Display Window</font></center>
<p>
The  <i>Sky Display</i>
button in the main window toggles the display on and off (it does
take a lot of screen real estate).  
The window plots a map of the sky, showing stars to V = 4.5, the 
sun, moon, and the planets (including Pluto, whatever you want to
call it).  If you have an object list loaded, it
also plots each object as a text string, the bottom of which is centered
on the object.  The coordinates in the main program are marked 
with a greenish box.  The stars are generally not plotted in a pure
white, but with a color derived from the spectral type; the RGB
values chosen to represent the spectral types are based on those 
computed by M. N. Charity (see 
http://www.vendian.org/mncharity/dir3/starcolor/).  I de-saturated
his suggested colors slightly (moved them toward white) because
the full colors were a bit distracting. 
<p>
Red arcs indicate the meridian, the equator, and
lines of constant hour angle every 2 h out to +- 6 h.  Dotted
red circles indicate 2, 3, and 4 airmasses.
<p>
The moon is drawn at exaggerated size but in the correct phase
and orientation.  The planets are sized according to magnitude, with
the fainter ones rendered as very small dots.  A clock drawn in the upper
right corner shows the prevailing <i>local</i> time; the 
Site and Universal Time information are printed at the lower right.  
The background color is controlled by where the sun is -- when
there is no twilight the background is black (even if the moon
is bright).  There's a small, discontinous
jump to dark grey at the beginning and end of twilight, and
a continuous ramp between twilight and daylight, which is
rendered in blue.   This proves very helpful in keeping the 
user oriented in time.
<p>
The sky display updates whenever the main window changes, so the 
Auto Step command results in a somewhat jerky animation.  
<p>
The sky display recognizes several <b> mouse and keyboard commands </b>, as
follows.  But first, note that <i> the window will not respond to the keyboard
commands unless it has focus</i> (with most systems, this is 
indicated by some kind of change in the window border).  The mouse
commands work regardless (though I have heard of people having
issues with these features on Macs running OS-X).
<ul>
<li> <i> Pressing and holding the Right Mouse Button</i> pops up a little 
command summary.
<li> <i> Middle Mouse Button </i> (or typing 'c' at the keyboard) sets the
position in the main program to the position of the mouse.
<li> <i> Left Mouse Button </i>, or 's', looks for the listed object nearest the 
mouse, and sets the main window to that object.  You need to hit it within
about 5 degrees.
<li>  'f' - step the time forward (same as "Step Forward") in the main
window.
<li>  'b' - step the time back (same as "Step Back") in the main
window.
<li>  'z' - Zoom in by a factor of two around the mouse position.
<li>  'o' - zoom Out by a factor of two around the mouse position.
<li>  'p' - Pan, or recenter at the mouse position.
<li>  'r' - Restore the original view.
<li>  'h' - set the coordinates and object name to that of the bright
(HR catalog) star closest to the cursor.  
</ul>
It's a minor detail, but the stars are precessed to the current
equinox whenever their coordinates are more than one year out of date;
they are not precessed with every refresh to save computation
time.  One notices this with the 'h' command - the coordinates
loaded will be close to the equinox of date, rather than (say)
J2000.  The planets, sun, and moon are already in the equinox of date.  
The object list is precessed with every refresh.
<p>
<center><font size ="+1">Bugs, "Gotchas", and Limitations</font></center>
<p>
This is surely an incomplete list:
<ul>
<li> <b>Do not use trust this program for archeoastronomy.</b>  It is 
designed for use near the present time and the calendrical, lunar, 
precession, and planetary calculations will surely be flaky outside of a 
couple centuries from the present time.  It should work well 
within that range.
<li> <b>This program is not designed as a teaching tool</b>.  While it
can certainly be used to supplement instruction, it isn't meant to 
be a standalone tutorial.  Users are expected to understand the relevant
concepts. 
<li> <b>The code has not been extensively tested at high geographic latitudes</b>.  
<li> <b>The planetary ephemeris used is not particularly accurate</b> -- it is
meant to be small, portable, reasonably fast, and "good enough".  If you 
need to aim directly at a planet, or calculate stellar occultations,
use something else, e.g. get your positions from the JPL Horizons site.  
<li> <b>The sky display is not a full-featured planetarium program,</b>  
like Elwood Downey's excellent XEphem (for unix/linux) or Bill Gray's
Guide program (for Windows), or any of the many other commercially 
available programs.  It is meant as a tool for planning and carrying
out observations.  
<li> <b> The source code is messy.</b>  I've written a lot of code in my
life but I am a novice with Java, so the souce code has many shortcomings
and aesthetic flaws (e.g., no consistent capitalization style).  It is 
distributed as one giant file, which is not the usual practice.  However,
it does run!
</ul>
<p>
<center><font size="+1">About the Program</font></center>
<p>
This program is a re-implementation in Java of the venerable <i>skycalc</i> code,
which is a text-only program written entirely in C.  A couple of years
ago I wrote a graphical user interface for <i>skycalc</i> by wrapping the 
C routines in Python and implementing the user interface with Python's
Tkinter module.  One version of this also has a sky display, which uses
the Python wrapper around PGPLOT.  This has proven extremely useful, but 
the software dependencies make installation complicated (and probably impossible
on Windows), so I undertook the present effort for the sake of 
portability.  
<p>
<b>Accuracy.</b>  A rough extrapolation of delta-T is used for the time
argument of the lunar and solar calculations.  The sun should be good
to 1 arcsecond or so, the moon to a few arcseconds.  Comparison with the 
JPL ephemerides shows that the barycentric corrections are good to 
a few meters per second in velocity and a few hundredths of a second in
time.  The precession routine used conforms to the IAU 1976 resolutions,
and is not as rigorous as the 2000 conventions; the penalty in accuracy
is of order 0.1 arcsecond.  As noted above, the planetary 
ephemerides are only accurate enough for rough purposes.  The text-based 
Skycalc program has an extensive manual describing the algorithms
used; the present Java code uses the same algorithms (and gives identical
results as far as I have been able to test).
<p>
<b>Legalities.</b>  I am offering this program freely but claim copyright.
Anyone may copy and modify the code, provided that the
credit banner with my name and institutional affiliation is not altered.
Although I have been careful to ensure that the code is correct, I make no
claim that it will always be correct or sufficiently accurate.  I also
make no claim that it will be suitable for your application.  This code
should never be relied for applications in which personal safety might
be an issue, and it should not be considered authoritative for legal
purposes.   
<p>
I will not be able to answer all queries, but if you believe there 
is a bug, or have a suggestion for an improvement, or just want to comment,
please do email me (john dot thorstensen at dartmouth dot edu).   

